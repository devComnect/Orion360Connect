<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OKRs</title>
  <link rel="icon" href="{{ url_for('static', filename='img/icone.png') }}">

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style_okrs.css') }}">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Estilos customizados -->

  <!-- Plugin de AnotaÃ§Ã£o (metas) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
</head>

<body>
  {% include 'header/model-header.html' %}

  <div class="container-fluid my-4 px-5">
    <!-- BotÃ£o Voltar-->
    <div class="row mb-2">
      <div class="col-auto">
        <div class="btn-group" role="group" aria-label="bottomVoltar">
          <a href="{{ url_for('home_bp.render_insights') }}" class="btn btn-outline-secondary">Voltar</a>
        </div>
      </div>
    </div>

    <div class="row justify-content-center text-white">
      <h1 class="text-center">OKRs</h1>
    </div>


    <div class="text-end mb-3">
      <!--<button class="btn btn-sm btn-outline-light me-2" onclick="exportarPDF()">ðŸ“„ Exportar PDF</button>
      <button class="btn btn-sm btn-outline-light" onclick="exportarExcel()">ðŸ“Š Exportar Excel</button>-->
      <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#modalDefinirMetas">
        ðŸ“Š Definir Metas
      </button>
    </div>

    <!-- BotÃµes de filtro de perÃ­odo -->
    <div class="row justify-content-center mb-4">
      <div class="col-auto">
        <div class="btn-group">
          <button class="btn btn-outline-secondary filtro-btn" data-dias="30">MÃªs</button>
          <button class="btn btn-outline-secondary filtro-btn" data-dias="90">Trimestre</button>
          <button class="btn btn-outline-secondary filtro-btn" data-dias="180">Semestre</button>
        </div>
      </div>
    </div>

    <!-- Fluxograma - layout em Ã¡rvore -->
    <div class="fluxograma text-white">

      <!-- NÃ­vel 1 -->
      <div class="fluxo-card nivel-1">
        <h6>Chamados</h6>
        <div class="info-item">
          <span>Reabertos</span>
          <span class="value text-white">
            <a href="#" onclick="mostrarChamadosOperador('Chamados Reabertos do Operador', chamadosReabertosCodigos)">
              <span id="chamado_reaberto">0</span>
            </a> / <span id="percentual_reaberto">0</span>
          </span>
        </div>
        <div class="info-item">
          <span>FCR</span>
          <span class="value text-white">
            <a href="#" onclick="mostrarChamadosOperador('Chamados com FCR do Operador', chamadosFcrCodigos)">
              <span id="chamado_fcr">0</span>
            </a> / <span id="percentual_fcr">0</span>
          </span>
        </div>
      </div>

      <!-- NÃ­vel 2 esquerdo -->
      <div class="fluxo-card nivel-2-esq">
        <h6>Tempo MÃ©dio</h6>
        <h6 class="text-center mb-2">Chamados</h6>
        <div class="info-item"><span class="text-warning">TMA</span><span class="value" id="percentual-tma">0</span></div>
        <div class="info-item"><span class="text-success">TMS</span><span class="value" id="percentual-tms">0</span></div>
        <h6 class="text-center mt-3 mb-2">LigaÃ§Ãµes</h6>
        <div class="info-item"><span class="text-success">TMIN</span><span class="value" id="percentual-tma-ligacoes">0</span></div>
        <div class="info-item"><span class="text-danger">TMAX</span><span class="value" id="percentual-tms-ligacoes">0</span></div>
      </div>

      <!-- NÃ­vel 2 direito -->
      <div class="fluxo-card nivel-2-dir">
        <h6>SLA</h6>
        <h6 class="text-center mb-2">Atendimento</h6>
        <div class="info-item">
          <span class="text-danger">Expirados</span>
          <span class="value"><a href="#" onclick="mostrarCodigosSla('Atendimento Expirado', codigosAtendimento)"><span id="sla_atendimento_expirado">0</span></a></span>
        </div>
        <div class="info-item"><span class="text-success">No Prazo</span><span class="value" id="sla_atendimento_prazo">0</span></div>
        <h6 class="text-center mt-3 mb-2">ResoluÃ§Ã£o</h6>
        <div class="info-item">
          <span class="text-danger">Expirados</span>
          <span class="value"><a href="#" onclick="mostrarCodigosSla('ResoluÃ§Ã£o Expirada', codigosResolucao)"><span id="sla_resolucao_expirado">-</span></a></span>
        </div>
        <div class="info-item"><span class="text-success">No Prazo</span><span class="value" id="percentual_prazo_resolucao">0</span></div>
      </div>

      <!-- NÃ­vel 3 -->
      <div class="fluxo-card nivel-3">
        <h6>SatisfaÃ§Ã£o</h6>
        <div class="info-item"><span>CSAT</span><span class="value" id="csat-percentual">0%</span></div>
        <div class="info-item"><span>Total Avaliado</span><span class="value" id="total-avaliado">0</span></div>
        <div class="info-item"><span>CES</span><span class="value" id="ces-nota">0</span></div>
        <div class="info-item"><span>ClassificaÃ§Ã£o</span><span class="value" id="ces-descricao">-</span></div>
        <div class="info-item"><span>NPS</span><span class="value" id="nps-retorno">0</span></div>
        <div class="info-item"><span>ClassificaÃ§Ã£o </span><span class="value" id="nps-null">0</span></div>
      </div>
    </div>

    <!-- GrÃ¡fico de EvoluÃ§Ã£o Mensal dos OKRs -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="fluxo-card" style="position: relative; padding: 2rem;">
        <h5 class="text-center mb-4" style="font-weight: 700; font-size: 1.5rem; color: #e0e0ff; text-shadow: 0 0 8px rgba(224,224,255,0.7);">
          EvoluÃ§Ã£o Mensal dos OKRs
        </h5>
        <canvas id="graficoEvolucaoOKRs" height="120"></canvas>
      </div>
    </div>
</div>


  </div> <!-- FIM da container-fluid -->

  <!-- Modal para mostrar os cÃ³digos -->
<div class="modal fade" id="modalCodigos" tabindex="-1" aria-labelledby="modalCodigosLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="background-color: #121212; color: #f1f1f1;">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="modalCodigosLabel">Chamados</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
        <ul id="listaCodigos" class="list-unstyled mb-0"></ul>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Definir Metas -->
<div class="modal fade" id="modalDefinirMetas" tabindex="-1" aria-labelledby="modalDefinirMetasLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="background-color: #1c1c1c; color: #fff;">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="modalDefinirMetasLabel">Definir Metas</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <form id="formMetas">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Reabertos</label>
              <input type="number" class="form-control bg-dark text-white" name="reabertos">
            </div>
            <div class="col-md-4">
              <label class="form-label">FCR</label>
              <input type="number" class="form-control bg-dark text-white" name="fcr">
            </div>
            <div class="col-md-4">
              <label class="form-label">TMA</label>
              <input type="number" class="form-control bg-dark text-white" name="tma">
            </div>
            <div class="col-md-4">
              <label class="form-label">TMS</label>
              <input type="number" class="form-control bg-dark text-white" name="tms">
            </div>
            <div class="col-md-4">
              <label class="form-label">TMIN</label>
              <input type="number" class="form-control bg-dark text-white" name="tmin">
            </div>
            <div class="col-md-4">
              <label class="form-label">TMAX</label>
              <input type="number" class="form-control bg-dark text-white" name="tmax">
            </div>
            <div class="col-md-6">
              <label class="form-label">SLA Atendimento Prazo</label>
              <input type="number" class="form-control bg-dark text-white" name="sla_atendimento_prazo">
            </div>
            <div class="col-md-6">
              <label class="form-label">SLA ResoluÃ§Ã£o Prazo</label>
              <input type="number" class="form-control bg-dark text-white" name="sla_resolucao_prazo">
            </div>
            <div class="col-md-6">
              <label class="form-label">CSAT</label>
              <input type="number" class="form-control bg-dark text-white" name="csat">
            </div>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="submit" class="btn btn-primary">Salvar Metas</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>


  {% include 'js/okrs_js.html' %}

  <!-- Chart Data Labels -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- html2pdf para exportar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <!-- SheetJS para exportar Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  
</body>
</html>
